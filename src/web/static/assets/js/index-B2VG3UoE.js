import{d as a,r as e,e as l,C as s,f as t,g as n,t as o,z as i,A as c,v as d,x as r,i as u,o as k,y as v,F as m,h as p,k as y,B as w,n as h,q as b}from"./vendor-BnMKHz0r.js";import{t as C}from"./tokens-CUAMeXud.js";import{_,b as f}from"./index-Brv2IJXv.js";const T=a("overview",()=>{const a=e([]),l=e(!1),s=e(null),t=async()=>{l.value=!0;try{a.value=await C.getAll()}catch(e){}finally{l.value=!1}};return{tokens:a,loading:l,editingToken:s,fetchTokens:t,addToken:async a=>{try{await C.add(a),await t()}catch(e){throw e}},updateToken:async(a,e)=>{try{await C.update(a,e),await t()}catch(l){throw l}},deleteToken:async a=>{try{await C.delete(a),await t()}catch(e){throw e}},startEdit:a=>{s.value={...a}},cancelEdit:()=>{s.value=null}}}),g={class:"modal-header"},x={class:"modal-title"},j={class:"modal-body"},A={class:"form-group"},I={class:"form-group"},U={class:"form-group"},V=_(l({__name:"TokenModal",props:{show:{type:Boolean},token:{}},emits:["close","save"],setup(a,{emit:l}){const v=a,m=l,p=u(()=>!!v.token),y=e({name:"",credential:"",daily_limit:0});s(()=>v.show,a=>{a&&v.token?y.value={name:v.token.name,credential:v.token.credential,daily_limit:v.token.daily_limit}:a&&(y.value={name:"",credential:"",daily_limit:0})});const w=()=>m("close"),h=()=>{m("save",{name:y.value.name,credential:y.value.credential,daily_limit:y.value.daily_limit})};return(e,l)=>a.show?(k(),t("div",{key:0,class:"modal-mask",onClick:w},[n("div",{class:"modal-box",onClick:l[3]||(l[3]=d(()=>{},["stop"]))},[n("div",g,[n("span",x,o(p.value?"编辑 Token":"添加 Token"),1),n("button",{class:"close-btn",onClick:w},"×")]),n("div",j,[n("div",A,[l[4]||(l[4]=n("label",null,"名称",-1)),i(n("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>y.value.name=a),placeholder:"Token 名称"},null,512),[[c,y.value.name]])]),n("div",I,[l[5]||(l[5]=n("label",null,"凭证",-1)),i(n("input",{"onUpdate:modelValue":l[1]||(l[1]=a=>y.value.credential=a),placeholder:"API Key",type:"password"},null,512),[[c,y.value.credential]])]),n("div",U,[l[6]||(l[6]=n("label",null,"每日限额 ($)",-1)),i(n("input",{"onUpdate:modelValue":l[2]||(l[2]=a=>y.value.daily_limit=a),type:"number",min:"0",step:"0.01"},null,512),[[c,y.value.daily_limit,void 0,{number:!0}]])])]),n("div",{class:"modal-footer"},[n("button",{class:"btn-cancel",onClick:w},"取消"),n("button",{class:"btn-save",onClick:h},"保存")])])])):r("",!0)}}),[["__scopeId","data-v-a6431785"]]),$={class:"overview"},B={key:0,class:"del-confirm"},E={class:"del-text"},F={class:"del-actions"},M=["onClick"],S={class:"token-row1"},q=["onClick"],z=["onClick"],K=["onClick"],P={key:0,class:"progress-section"},D={class:"progress-bar"},G={class:"cost-row"},H={class:"cost-val"},J={class:"cost-limit"},L={class:"expire-text"},N={key:1,class:"simple-row"},O={class:"cost-accent"},Q={class:"expire-dim"},R=_(l({__name:"index",setup(a){const l=T(),{success:s,error:i}=f(),c=e(null),d=e([]),r=w({show:!1,token:null}),u=async()=>{await l.fetchTokens(),d.value=l.tokens},C=a=>a>14?"green":a>7?"yellow":"red",_=a=>{const e=parseFloat(String(a.cost).replace("$","").replace(",",""))||0;return Math.min(e/a.limit*100,100)},g=a=>{const e=_(a);return e>90?"red":e>70?"yellow":"accent"},x=()=>{r.token=null,r.show=!0},j=async a=>{try{r.token?(await l.updateToken(r.token.index,a),s("已更新")):(await l.addToken(a),s("已添加")),r.show=!1,await u()}catch{i("保存失败")}};return v(u),(a,e)=>(k(),t("div",$,[(k(!0),t(m,null,p(d.value,(a,d)=>(k(),t("div",{key:d,class:"token-card"},[c.value===d?(k(),t("div",B,[n("span",E,"删除 "+o(a.name)+"?",1),n("div",F,[n("button",{class:"del-ok",onClick:a=>(async a=>{try{await l.deleteToken(a),c.value=null,await u(),s("已删除")}catch{i("删除失败")}})(d)},"确定",8,M),n("button",{class:"del-cancel",onClick:e[0]||(e[0]=a=>c.value=null)},"取消")])])):(k(),t(m,{key:1},[n("div",S,[n("span",{class:h(["status-dot",C(a.days)])},null,2),n("span",{class:"token-name",onClick:a=>{}},o(a.name),9,q),n("span",{class:h(["days-pill",C(a.days)])},o(a.days)+"d",3),n("button",{class:"icon-btn",onClick:a=>(a=>{r.token=l.tokens[a],r.show=!0})(d),title:"编辑"},"✎",8,z),n("button",{class:"icon-btn",onClick:a=>c.value=d,title:"删除"},"×",8,K)]),a.limit>0?(k(),t("div",P,[n("div",D,[n("div",{class:h(["progress-fill",g(a)]),style:b({width:_(a)+"%"})},null,6)]),n("div",G,[n("span",H,o(a.cost),1),n("span",J,"/ $"+o(a.limit),1)]),n("span",L,o(a.expire),1)])):(k(),t("div",N,[n("span",O,o(a.cost),1),n("span",Q,o(a.expire),1)]))],64))]))),128)),n("div",{class:"add-btn",onClick:x},"+ 添加 Token"),y(V,{show:r.show,token:r.token,onClose:e[1]||(e[1]=a=>r.show=!1),onSave:j},null,8,["show","token"])]))}}),[["__scopeId","data-v-7ad927de"]]);export{R as default};
